<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Tea party event calculator - Lapis Re:LiGHTs English Fan Guide</title>

<meta name="description" content="Rough tool for calculating expected reward income for tea party events.">
<link rel="canonical" href="https://xeals.github.io/lapilai/tools/tea-party"><link rel="alternate" type="application/rss+xml" title="Lapis Re:LiGHTs English Fan Guide" href="/lapilai/feed.xml"><link rel="apple-touch-icon" sizes="180x180" href="/lapilai/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/lapilai/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/lapilai/assets/favicon-16x16.png"><link rel="manifest" href="/lapilai/assets/site.webmanifest"><link rel="mask-icon" href="/lapilai/assets/safari-pinned-tab.svg" color="#e95098"><link rel="shortcut icon" href="/lapilai/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#e95098"><meta name="msapplication-config" content="/lapilai/assets/browserconfig.xml">

<meta name="theme-color" content="#e95098">
<!-- end favicons snippet -->
<link rel="stylesheet" href="/lapilai/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><link rel="stylesheet" href="/lapilai/assets/css/types.css">

<style>
  figure {
      display: flex;
      flex-direction: column;
  }
  figure img {
      max-height: 200px;
      align-self: center;
  }
  figure figcaption {
      text-align: center;
  }

  figure img.large {
      max-height: 400px;
  }

  .item__image {
      align-self: center;
  }

  td > ul {
      margin-top: 0 !important;
      margin-bottom: 0 !important;
  }
</style>

<meta property="og:title"
    content="Tea party event calculator" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xeals.github.io/lapilai/tools/tea-party" />

<meta property="og:site_name" content="Lapis Re:LiGHTs English Fan Guide" />

<meta property="og:locale" content="en_AU" />


<meta property="og:image" content="https://xeals.github.io/lapilai/assets/og.png" />
<meta property="og:image:height" content="256" />
<meta property="og:image:width" content="256" />

<meta name="twitter:card"
    content="summary" />
<meta property="twitter:image" content="/assets/og.png" />


<meta property="og:description"
    content="Rough tool for calculating expected reward income for tea party events." />


<meta name="theme-color" content="#e95098" />


<script async defer data-website-id="aa3431ba-de7c-4c43-8cb8-e054b9628ef7" src="https://stats.xeal.me/umami.js"></script>

<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/lapilai/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page layout--page--sidebar clearfix js-page-root">
  <div class="page__mask d-print-none js-page-mask js-sidebar-hide"></div>
  <div class="page__viewport">
    <div class="page__actions d-print-none">
      <div class="button button--circle button--lg box-shadow-2 sidebar-button js-sidebar-show">
        <i class="fas fa-bars icon--show"></i>
      </div>
    </div>

    <div class="grid page__grid">

      <div class="page__sidebar d-print-none"><div class="sidebar-toc"><ul class="toc toc--navigator"><li class="toc-h1">Tools</li><li class="toc-h2 active"><a href="/lapilai/tools/tea-party">Tea party event calculator</a></li></ul></div></div><div class="page__main js-page-main has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24">
<style type="text/css">
	.st0{fill:#515151;}
</style>
<path class="st0" d="M1.7,22.3c5.7-5.7,11.3-5.7,17,0c3.3-3.3,3.5-5.3,0.8-6c2.7,0.7,3.5-1.1,2.3-5.6s-3.3-5.2-6.3-2.1
	c3-3,2.3-5.2-2.1-6.3S7,1.8,7.7,4.6C7,1.8,5,2.1,1.7,5.3C7.3,11,7.3,16.7,1.7,22.3"/>
</svg>
<a title="Fan-made English documentation for helping new players navigating around Lapis Re:LiGHTs.
" href="/lapilai/">Lapis Re:LiGHTs English Fan Guide</a></div></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/lapilai/guide/faq">How to play</a></li><li class="navigation__item"><a href="/lapilai/content">Translated content</a></li><li class="navigation__item"><a href="/lapilai/tools">Tools</a></li><li class="navigation__item"><a href="/lapilai/card">Cards</a></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>Tea party event calculator</h1></header></div><meta itemprop="headline" content="Tea party event calculator"><div class="article__info clearfix"><ul class="right-col menu"></ul></div><meta itemprop="author" content="Your Name"/><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><style>
  input {
    border: none;
    border-bottom: 4px solid #fc4d50;
  }

  select {
    background: none;
    border: none;
    border-bottom: 4px solid #fc4d50;
  }

  .calc {
    display: flex;
    flex-direction: column;
    gap: 1em;
  }

  .calc__duration {
    display: flex;
    flex-direction: column;
    justify-content: space-around;
  }

  .calc__duration__section {
      display: flex;
      flex-direction: column;
  }

  @media (min-width: 500px) {
    .calc__duration {
      flex-direction: row;
    }
  }

  .calc__stamina > label,
  .calc__quests > label,
  .calc__quest-ult > label {
      font-weight: bold;
  }

  .calc__form-row {
      display: flex;
      position: relative;
      padding-left: 8.5em;
  }

  .calc__form-row__content {
      width: 100%;
  }

  @media (min-width: 500px) {
      .calc__form-row__content {
          max-width: 200px;
      }
  }

  .calc__form-row__label {
      position: absolute;
      top: 0;
      left: 0;
      max-width: 8em;
  }

  .calc__totals {
    display: flex;
    flex-direction: column;
    align-self: center;
    align-items: center;
    border: 3px solid lightgray;
    border-radius: 0.5em;
    padding: 1em;
  }

  .calc__totals label {
    font-weight: bold;
  }

  .calc__totals span {
    padding-bottom: 0.25em;
  }

  #total[ended="true"] {
      visibility: hidden;
  }

  #total[ended="true"]::after {
      visibility: visible;
      content: "This event has ended.";
  }
</style>

<p>
  This calculator aims to give an idea of how much of the event you should be
  able to clear given your stamina gain and the missions you can clear. To use
  it, set up your stamina gain (some common options are provided as checkboxes),
  and the quest nodes that you will be farming on.
</p>

<p>
  <b>This is an estimate</b>. Not all variables are accounted for (such as level
  up stamina, stamina reserves, or already-claimed daily bonuses). In most cases
  the provided number should be a <i>minimum</i> expected attempts. Like most
  calculators of this kind, it assumes optimal stamina usage, rather than
  letting it sit capped.
</p>

<p>
  Daily bonuses (for bonus keys and lottery attempts) are assumed to be
  completed at the same mission level you select. If the ultimate boss can be
  cleared, it is assumed to be eligible for the daily bonus (which is strictly
  optimal due to its cost-reward ratio). Obviously, these cases will not be true
  for day 1 of the event, so keep this in mind.
</p>

<hr>

<div class="calc">
  <div class="calc__duration">
    <div class="calc__duration__section">
      <label id="durationDtLabel" for="durationDt">
        Event end time (local)
      </label>
      <input type="datetime-local" id="durationDt">
    </div>

    <div class="calc__duration__section">
      <label for="duration">
        Hours remaining
      </label>
      <input type="number" min="0" id="duration">
    </div>
  </div>

  <div id="sec-stamina" class="calc__stamina">
    <label for="sec-stamina">Stamina</label>

    <div class="calc__form-row">
      <input type="checkbox" id="stamPassive" checked>
      <label for="stamPassive">
        Passive restoration
      </label>
    </div>

    <div class="calc__form-row">
      <input type="checkbox" id="stamLogin" checked>
      <label for="stamLogin">
        Login bonuses
      </label>
    </div>

    <div class="calc__form-row">
      <input type="checkbox" id="stamFriend">
      <label for="stamFriend">
        Friendship tokens
      </label>
    </div>

    <div class="calc__form-row">
      <input type="checkbox" id="stamRoom">
      <label for="stamRoom">
        Dining room
      </label>
    </div>

    <div class="calc__form-row">
      <input type="checkbox" id="stamActivities">
      <label for="stamActivities">
        Activities
      </label>
    </div>

    <div class="calc__form-row">
      <label for="stamExtra" class="calc__form-row__label">
        Extra per day
      </label>
      <input type="number" min="0" id="stamExtra" class="calc__form-row__content">
    </div>

    <div style="padding-top: 0.5em">
      <label for="stamTotal">
        Effective stamina per hour:
      </label>
      <span id="stamTotal"></span>
    </div>
  </div>

  <div id="sec-quests" class="calc__quests">
    <label id="sec-quests">Missions</label>

    <div class="calc__form-row">
      <label for="quest" class="calc__form-row__label">
        Quest
      </label>
      <select id="quest" class="calc__form-row__content">
        <option value="1,6">1 / 2</option>
        <option value="1.5,9">3</option>
        <option value="2,9">4 / 5</option>
        <option value="2.5,12">6</option>
        <option value="3,12">7 / 8</option>
        <option value="4,15">9 / 10</option>
        <option value="4.5,15">11</option>
        <option value="5.5,18">12</option>
        <option value="6,18">13</option>
      </select>
    </div>

    <div class="calc__form-row">
      <label for="boss" class="calc__form-row__label">
        Boss
      </label>
      <select id="boss" class="calc__form-row__content">
        <option value="3,9">Easy</option>
        <option value="5,12">Normal</option>
        <option value="7.5,15">Advanced</option>
        <option value="10,18">Hard</option>
        <option value="12,21">Extreme</option>
      </select>
    </div>
  </div>

  <div id="sec-ultimateBoss" class="calc__quest-ult">
    <label for="sec-ultimateBoss">
      Ultimate boss
    </label>
    <div class="calc__form-row">
      <input type="checkbox" id="ultEnable">
      <label for="ultEnable">
        Clear?
      </label>
    </div>
    <div class="calc__form-row">
      <label for="ultClears" class="calc__form-row__label">
        Attempts to clear
      </label>
      <input type="number" value="1" min="1" id="ultClears" class="calc__form-row__content">
    </div>
  </div>

  <div class="calc__totals">
    <span id="questEff"></span>
    <span id="bossEff"></span>
    <label for="total">Estimated lottery attempts</label>
    <span id="total"></span>
  </div>
</div>

<script>
  (function () {
    const EVENTS = [
      {
        name: "Christmas",
        end: "2022-01-04T12:00+09:00",
      },
      {
        name: "Sky Stage",
        end: "2022-01-26T23:59:59+09:00"
      },
      {
        name: "Valentines",
        end: "2022-02-28T23:59:59+09:00"
      },
      {
        name: "Sakura",
        end: "2022-04-30T23:59:59+09:00"
      },
      {
        name: "Christmas v2",
        start: "2022-06-21T12:00:00+09:00",
        end: "2022-07-05T23:59:59+09:00"
      }
    ];

    /**
     * Stamina gain per day.
     */
    function staminaGain() {
      const vals = [
        $("#stamPassive").prop("checked") ? 240 : 0,
        $("#stamLogin").prop("checked") ? 140 : 0,
        $("#stamFriend").prop("checked") ? 100 : 0,
        $("#stamRoom").prop("checked") ? 120 : 0,
        $("#stamActivities").prop("checked") ? 120 : 0,
        parseInt($("#stamExtra").val()) || 0,
      ];
      return vals.reduce(function (prev, curr) {
        return prev + curr;
      }, 0) / 24;
    }

    function questRewards(stamina, node) {
      const [reward, cost] = node.split(",");
      return Math.floor(stamina / parseFloat(cost)) * parseFloat(reward);
    }

    function bossRewards(keys, node) {
      const [reward, cost] = node.split(",");
      return Math.floor(keys / parseFloat(cost)) * parseFloat(reward);
    }

    function nodeCostValue(node) {
      return parseFloat(node.split(",")[1]);
    }

    function nodeRewardValue(node) {
      return parseFloat(node.split(",")[0]);
    }

    const ultimateNode = "35,15";

    const SOURCES = window.TEXT_VARIABLES.sources;
    window.Lazyload.js(SOURCES.jquery, function () {
      $quest = $("#quest");
      $boss = $("#boss");
      $ult = $("#ultClears");
      $ultEnable = $("#ultEnable");

      $duration = $("#duration");
      $questEff = $("#questEff");
      $bossEff = $("#bossEff");
      $total = $("#total");

      function _update() {
        const duration = parseFloat($duration.val()) || 0;
        const days = Math.floor(duration / 24);
        const stamgain = staminaGain();
        const stamina = stamgain * duration;

        // Base rate + daily rewards.
        var keys = questRewards(stamina, $quest.val()) + (nodeRewardValue($quest.val()) * days);
        var rewards = 0;

        if ($ultEnable.prop("checked")) {
          const attempts = $ult.val() || 1;
          keys -= nodeCostValue(ultimateNode) * attempts * days;
          // Daily rewards at ultimate rate, as well as base reward.
          rewards += 2 * (nodeRewardValue(ultimateNode) * days);
        } else {
          // Daily rewards at highest rate.
          rewards += nodeRewardValue($boss.val()) * days;
        }
        rewards += bossRewards(keys, $boss.val());

        $total.text(Math.floor(rewards));
      }

      $duration.change(_update);
      $quest.change(_update);
      $boss.change(_update);
      $ult.change(_update);
      $ultEnable.change(_update);

      $ultEnable.change(function() {
        $ult.prop("disabled", !$(this).prop("checked"));
      });
      $ult.prop("disabled", true);

      function _updateStamina() {
        $("#stamTotal").text(staminaGain().toFixed(1));
      }

      $("#sec-stamina :input").each(function (index, node) {
        const $node = $(node);
        $node.change(_update);
        $node.change(_updateStamina);
      });

      const $durationDt = $("#durationDt");
      function _updateDuration() {
        const ms = new Date($durationDt.val()) - Date.now();
        const hours = ms / 3600_000;
        $duration.val(Math.max(0, hours.toFixed(2)));
      }
      $durationDt.change(_updateDuration);

      function _formatDate(date) {
        return new Date(date - date.getTimezoneOffset() * 60_000).toISOString().slice(0, -1);
      }

      $duration.change(function () {
        const hours = $(this).val();
        const hoursF = parseFloat(hours) || 0;
        const time = new Date(Date.now() + hoursF * 3600_000);
        time.setMilliseconds(0);
        $durationDt.val(_formatDate(time));
        $total.attr("ended", hoursF === 0);
      });

      // Load latest event
      const currEventEnd = new Date(EVENTS[EVENTS.length-1].end);
      const localEventEnd = _formatDate(currEventEnd);
      $durationDt.val(localEventEnd);

      $("#durationDtLabel").contents()
        .filter(function() { return this.nodeType === 3; })
        .each(function() {
          this.textContent = this.textContent.replace(
            "local", Intl.DateTimeFormat().resolvedOptions().timeZone);
        });


      _updateStamina();
      _updateDuration();
      _update();
    });
  })();
</script>

<!-- Local Variables: -->
<!-- js-indent-level: 2 -->
<!-- End: -->
</div><div class="d-print-none"><footer class="article__footer"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
</footer>
</div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none"><footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Your Name"><meta itemprop="url" content="/lapilai/"><meta itemprop="description" content="I am an amazing person."><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>This site is not representitive of and is not associated
with <a href="https://lapisrelights.com">Lapis Re:LIGHTs</a>.  Lapis Re:LiGHTs
is © KLabGames and KADOKAWA CORPORATION 2017-2021. All logos, images, and game
content used in this site are Trademarks of the aforementioned entities.
<br>
Site content is provided by the Lapis Re:LiGHTs English Fan Discord Server
        contributors 2021.
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator."
          href="http://jekyllrb.com/">Jekyll</a> & <a title="TeXt is a super customizable Jekyll theme."
          href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div></div></div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"></div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;

  window.Lazyload.js(SOURCES.jquery, function() {
    var $pageMask = $('.js-page-mask');
    var $pageRoot = $('.js-page-root');
    var $sidebarShow = $('.js-sidebar-show');
    var $sidebarHide = $('.js-sidebar-hide');

    function freeze(e) {
      if (e.target === $pageMask[0]) {
        e.preventDefault();
      }
    }
    function stopBodyScrolling(bool) {
      if (bool === true) {
        window.addEventListener('touchmove', freeze, { passive: false });
      } else {
        window.removeEventListener('touchmove', freeze, { passive: false });
      }
    }

    $sidebarShow.on('click', function() {
      stopBodyScrolling(true); $pageRoot.addClass('show-sidebar');
    });
    $sidebarHide.on('click', function() {
      stopBodyScrolling(false); $pageRoot.removeClass('show-sidebar');
    });
  });
})();
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

